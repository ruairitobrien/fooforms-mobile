angular.module("fooforms",["ionic","lodash","restangular","authentication","dashboard"]).run(function(e,t){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleBlackOpaque()})}).config(function(e){"use strict";e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|tel):/)}).config(function(e){"use strict";e.defaults.timeout=1e4}).config(function(e){e.setBaseUrl("/api"),e.setDefaultHeaders({"Content-Type":"application/json"}),e.setRestangularFields({id:"_id",selfLink:"self.link"}),e.addResponseInterceptor(function(e,t){var o;return"getList"===t&&e.data?(o=e.data,o.has_more=e.has_more,o.objectType=e.object):o=e,o})}).config(function(e,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl",resolve:{session:function(e){return e.checkSession()}}}).state("app.home",{url:"/home",views:{menuContent:{controller:"HomeCtrl",templateUrl:"templates/home.html"}}}).state("app.dashboard",{url:"/dashboard",views:{menuContent:{controller:"DashboardCtrl",templateUrl:"templates/dashboard.html"}}}).state("app.logout",{url:"/logout",views:{menuContent:{controller:"LogoutCtrl",templateUrl:"templates/home.html"}}}),t.otherwise("/app/home")}).directive("hideOnErr",function(){"use strict";return{link:function(e,t){t.bind("error",function(){t.hide()})}}}).factory("SessionService",["$location","$q","$log","_","AuthService","DashboardService","OrganisationService","Session",function(e,t,o,r,s,n,a,i){return{checkSession:function(){var l=t.defer();return s.isAuthenticated()?l.resolve(i.user):s.checkStoredCredentials(function(t){t&&o.log(t),s.isAuthenticated()?n.getUserDashboard(function(e,t){e?o.error(e):(t.photo||(t.photo="/assets/images/photo.jpg"),t.self={},t.self.link="/api/users/"+t._id,i.user=t,r.forEach(i.user.organisations,function(e){e.teams=r.filter(i.user.teams,{organisation:e._id})}),i.org=angular.copy(i.user.organisations[0]),a.getMembers(i.user.organisations[0],function(e,t){i.org.members=t;for(var o=0;o<i.org.members.length;o++)i.org.members[o].self={},i.org.members[o].self.link="/api/users/"+i.org.members[o]._id}),l.resolve(i.user))}):"/signup"!==e.path()&&e.path("/login")}),l.promise}}}]);
angular.module("fooforms.controllers",[]).controller("AppCtrl",["$scope","$state","$ionicModal",function(o,n,l){l.fromTemplateUrl("templates/login.html",function(n){o.loginModal=n},{scope:o,animation:"slide-in-up",focusFirstInput:!0}),o.$on("$destroy",function(){o.loginModal.remove()})}]).controller("LoginCtrl",["$scope","$http","$state",function(o){o.message="",o.user={username:null,password:null},o.login=function(){},o.$on("event:auth-loginRequired",function(){o.loginModal.show()}),o.$on("event:auth-loginConfirmed",function(){o.username=null,o.password=null,o.loginModal.hide()}),o.$on("event:auth-login-failed",function(n,l){var e="Login failed.";401==l&&(e="Invalid Username or Password."),o.message=e}),o.$on("event:auth-logout-complete",function(){console.log("logout complete")})}]).controller("LogoutCtrl",["$scope",function(){}]).controller("HomeCtrl",["$scope",function(){}]).controller("DashboardCtrl",["$scope",function(){}]);
angular.module("lodash",[]).factory("_",function(){"use strict";return window._});
angular.module("authentication",["ngCookies"]);
angular.module("authentication").constant("USER_ROLES",{all:"*",admin:"admin",user:"user"}),angular.module("authentication").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"});
angular.module("authentication").controller("AuthCtrl",["$scope","$modal","$location","$log",function(o,e,r,n){var t,s,i,a;"/signup"===r.path()?(s="signupContent.html",i="SignupCtrl",a="sm"):"/login"===r.path()?(s="loginContent.html",i="LoginCtrl",a="sm"):window.location.href="/",t=e.open({templateUrl:s,controller:i,size:a,keyboard:!1,backdrop:"static",backdropClass:"auth-backdrop",windowClass:"auth-window modal-trans"}),t.result.then(function(o){o&&r.path("/dashboard")},function(o){n.error(o)})}]).controller("LoginCtrl",["$scope","$rootScope","$modalInstance","AUTH_EVENTS","AuthService",function(o,e,r,n,t){"use strict";o.sluggedUsername="",o.credentials={username:"",password:""},o.loginError=!1,o.login=function(s){t.clearCredentials(),t.setCredentials(s.username,s.password),t.login().success(function(s){t.isAuthenticated?(e.$broadcast(n.loginSuccess),r.close(!0)):o.loginError=s.message||"An error occurred while trying to log you in."}).error(function(r){t.clearCredentials(),e.$broadcast(n.loginFailed),o.loginError=r.message||"An error occurred while trying to log you in."})},o.close=function(){r.close(!1)}}]).controller("LogoutCtrl",["$scope","$rootScope","AUTH_EVENTS","AuthService",function(o,e,r,n){"use strict";o.logout=function(){n.clearCredentials(),e.$broadcast(r.logoutSuccess),window.location="/"}}]).controller("SignupCtrl",["$scope","$rootScope","$modalInstance","AUTH_EVENTS","AuthService",function(o,e,r,n,t){"use strict";o.details={},o.signupStage=1,o.validateStageOne=function(){o.details.organisationName&&o.details.email?o.signupStage=2:o.stageOneError="Please fill out all required fields"},o.signup=function(s){t.signup(s).success(function(){t.clearCredentials(),t.setCredentials(s.displayName,s.password);var i={username:s.displayName,password:s.password};t.login(i).success(function(s){t.isAuthenticated?(e.$broadcast(n.loginSuccess),r.close(!0)):o.signupError=s.message||"An error occurred while trying to log you in."}).error(function(r){t.clearCredentials(),e.$broadcast(n.loginFailed),o.signupError=r.message||"An error occurred while trying to log you in."})}).error(function(e){o.signupError=e.message||"An error occurred while trying to sign you up."})}}]);
angular.module("authentication").directive("uniqueUsername",["$http",function(e){return{require:"ngModel",link:function(n,t,i,r){n.busy=!1,n.$watch(i.ngModel,function(t){r.$setValidity("isTaken",!0),r.$setValidity("error",!0),r.$setValidity("invalidChars",!0),t&&(n.usernameBusy=!0,e.get("/signup/check/username/"+t).success(function(e){e.exists?(n.sluggedUsername="",r.$setValidity("isTaken",!1)):e.slugged&&(n.usernameBusy=!1,n.sluggedUsername=e.sluggedValue),n.usernameBusy=!1}).error(function(){n.sluggedUsername="",r.$setValidity("error",!1),n.usernameBusy=!1}))})}}}]).directive("uniqueOrgname",["$http",function(e){return{require:"ngModel",link:function(n,t,i,r){n.busy=!1,n.$watch(i.ngModel,function(t){r.$setValidity("isTaken",!0),r.$setValidity("error",!0),r.$setValidity("invalidChars",!0),t&&(n.orgnameBusy=!0,e.get("/signup/check/username/"+t).success(function(e){e.exists?(n.sluggedOrgName="",r.$setValidity("isTaken",!1)):e.slugged&&(n.sluggedOrgName=e.sluggedValue),n.orgnameBusy=!1}).error(function(){n.sluggedOrgName="",r.$setValidity("error",!1),n.orgnameBusy=!1}))})}}}]).directive("match",[function(){return{require:"ngModel",scope:{toMatch:"=match"},link:function(e,n,t,i){i.$validators.match=function(n){return n==e.toMatch},e.$watch("toMatch",function(){i.$validate()})}}}]).directive("different",[function(){return{require:"ngModel",link:function(e,n,t,i){e.$watch("["+t.ngModel+", "+t.different+"]",function(e){i.$setValidity("different",e[0]!=e[1])},!0)}}}]);
angular.module("authentication").factory("AuthService",["$rootScope","$cookieStore","$http","Base64","Session","AUTH_EVENTS",function(e,t,r,n,a,i){"use strict";return{login:function(){return r.post("/login")},signup:function(e){return r.post("/signup",e)},isAuthenticated:function(){return!!a.user},checkStoredCredentials:function(n){var o=t.get("authdata");return o?(r.defaults.headers.common.Authorization="Basic "+o,r.get("/api/users/check/me").success(function(t){a.create(t),e.$broadcast(i.loginSuccess),n(null,t)}).error(function(e,a){document.execCommand("ClearAuthenticationCache"),t.remove("authdata"),r.defaults.headers.common.Authorization="Basic ",n(e+" - "+a)})):void n("Login required.")},setCredentials:function(e,a){var i=n.encode(e+":"+a);r.defaults.headers.common.Authorization="Basic "+i,t.put("authdata",i)},clearCredentials:function(){document.execCommand("ClearAuthenticationCache"),t.remove("authdata"),r.defaults.headers.common.Authorization="Basic "}}}]).service("Session",function(){"use strict";return this.posts=[],this.org={},this.create=function(e){this.user=e},this.destroy=function(){this.user=null,this.posts=null},this}).factory("Base64",function(){"use strict";var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var r,n,a,i,o,c="",s="",u="",h=0;do r=t.charCodeAt(h++),n=t.charCodeAt(h++),s=t.charCodeAt(h++),a=r>>2,i=(3&r)<<4|n>>4,o=(15&n)<<2|s>>6,u=63&s,isNaN(n)?o=u=64:isNaN(s)&&(u=64),c=c+e.charAt(a)+e.charAt(i)+e.charAt(o)+e.charAt(u),r=n=s="",a=i=o=u="";while(h<t.length);return c},decode:function(t){var r,n,a,i,o,c="",s="",u="",h=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do a=e.indexOf(t.charAt(h++)),i=e.indexOf(t.charAt(h++)),o=e.indexOf(t.charAt(h++)),u=e.indexOf(t.charAt(h++)),r=a<<2|i>>4,n=(15&i)<<4|o>>2,s=(3&o)<<6|u,c+=String.fromCharCode(r),64!=o&&(c+=String.fromCharCode(n)),64!=u&&(c+=String.fromCharCode(s)),r=n=s="",a=i=o=u="";while(h<t.length);return c}}});
angular.module("dashboard",[]);
angular.module("dashboard").controller("DashboardCtrl",["$scope",function(){}]);
angular.module("dashboard").factory("DashboardService",["$log","Restangular","Session",function(r,e,n){"use strict";var t=e.all("dashboard");return{getUserDashboard:function(e){t.get("user/"+n.user._id).then(function(r){e(null,r)},function(n){r.error(n),e(n)})},getCurrentOrgOrUser:function(){t.get("")}}}]);